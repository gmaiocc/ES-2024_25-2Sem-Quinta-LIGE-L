<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualização de Dados CSV</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
    <h1>Visualização de Propriedades Rústicas</h1>
    <input type="file" id="fileInput" accept=".csv">
    <button onclick="processFile()">Gerar Gráfico 2D</button>
    <div id="myDiv" style="width: 700px; height: 500px;"></div>

    <script>
        function processFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert("Por favor, selecione um ficheiro CSV.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const csvData = event.target.result;
                console.log("CSV Lido:", csvData);

                // Envia os dados CSV para a API FastAPI
                fetch('http://127.0.0.1:8000/process_data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: csvData })
                })
                .then(response => response.json())
                .then(barData => {
                    console.log("Dados para gráfico recebidos:", barData);

                    // Verifica se os dados retornados contêm o gráfico em HTML
                    if (barData && barData.graph) {
                        // Insere o gráfico retornado no div
                        document.getElementById('myDiv').innerHTML = barData.graph;
                    } else {
                        console.error("Dados inválidos para o gráfico:", barData);
                        alert("Erro: Não foi possível gerar o gráfico.");
                    }
                })
                .catch(error => console.error('Erro ao processar o ficheiro:', error));
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
